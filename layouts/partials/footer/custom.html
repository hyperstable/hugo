<script>
// Debug: Check what's in the sidebar
console.log('Sidebar content check:');
const sidebar = document.querySelector('.docs-sidebar, .td-sidebar, aside');
if (sidebar) {
    console.log('Sidebar HTML:', sidebar.innerHTML.substring(0, 500));
    
    // Find all links in sidebar
    const links = sidebar.querySelectorAll('a');
    console.log('Total sidebar links:', links.length);
    
    // Check for section headers that should be dropdowns
    const sectionLinks = Array.from(links).filter(a => {
        const href = a.getAttribute('href');
        return href && (
            href.includes('/protocol/') ||
            href.includes('/peg/') ||
            href.includes('/security/') ||
            href.includes('/contracts/')
        );
    });
    console.log('Section links found:', sectionLinks.length);
}

// Force Bootstrap load if missing
if (typeof bootstrap === 'undefined') {
    const script = document.createElement('script');
    script.src = 'https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js';
    script.onload = function() {
        console.log('Bootstrap loaded via fallback');
        // Try to make dropdowns work
        document.querySelectorAll('a[href="#protocol"], a[href="#peg"], a[href="#security"], a[href="#contracts"]').forEach(link => {
            link.setAttribute('data-bs-toggle', 'collapse');
            link.classList.add('dropdown-toggle');
            
            // Create collapse target if missing
            const targetId = link.getAttribute('href').substring(1);
            let target = document.getElementById(targetId);
            if (!target) {
                target = link.nextElementSibling;
                if (target && target.tagName === 'UL') {
                    target.id = targetId;
                    target.classList.add('collapse');
                }
            }
        });
    };
    document.head.appendChild(script);
}
</script>
